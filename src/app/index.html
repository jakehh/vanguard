<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Vanguard</title>
    <link rel="stylesheet" href="lib/jquery/jquery-ui.css" />
    <link href="lib/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- <link href="resources/css/bootstrap.min.css" rel="stylesheet" media="screen"> -->
    <link href="resources/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="resources/css/alertify.min.css" rel="stylesheet" media="screen">
    <link href="resources/css/alertify-bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="resources/themes/yosemite/css/theme.css" rel="stylesheet" media="screen">
    <link href="resources/css/base.css" rel="stylesheet" media="screen">
    <!--<link href="resources/css/bootstrap-responsive.css" rel="stylesheet">-->

  </head>
  <body>
      <div id="holder"></div>
      <nav class="navbar navbar-default navbar-fixed-top" style="-webkit-app-region: drag" role="navigation">
          <!-- Collect the nav links, forms, and other content for toggling -->

          <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav appbuttons close-project" style="-webkit-app-region: no-drag">
                <li class="pull-left closebutton close-button" data-toggle="modal" data-target="#exit" draggable="false"></li>
                <li class="minimize-button" style="-webkit-app-region: no-drag" ></li>
                <li class="fullscreen-button fullscreen-expand" style="-webkit-app-region: no-drag"></li>
            </ul>
            <!-- Always showing App Control Buttons (Close/Max/Min) -->

            <ul class="nav navbar-nav landingnav" style="-webkit-app-region: no-drag" id="landingpage">
                <li>
                    <a class="newproject" href="#" data-container="body" data-placement="bottom" data-content="New Project" data-trigger="hover" draggable="false">
                      <i class="fa fa-file fa-3"></i>
                    </a>
                </li>
                <li>
                    <a class="openproject" href="#" data-container="body" data-placement="bottom" data-content="Open Project" data-trigger="hover" draggable="false">
                      <i class="fa fa-clipboard fa-3"></i>
                    </a>
                </li>
                <li>
                    <a class="collaborations" href="#" data-container="body" data-placement="bottom" data-content="Collaborate" data-trigger="hover" data-toggle="modal" data-target="#collaborate" draggable="false">
                      <i class="fa fa-users fa-3"></i>
                    </a>
                </li>
            </ul>
            <!-- Center Navigation on Landing page (New Project, Open Project, Collaboration) -->

            <ul class="nav navbar-nav projectnav" style="-webkit-app-region: no-drag">

                <li>
                    <a id="playPause" href="#" draggable="false">
                      <i class="fa fa-play fa-3 icon-playpause"></i>
                    </a>
                </li>

                <li>
                    <a id="stop" href="#" draggable="false">
                      <i class="fa fa-stop fa-3"></i>
                    </a>
                </li>

                <li class="endofcontrols">
                    <a id="step-backward" href="#" draggable="false">
                      <i class="fa fa-step-backward fa-3"></i>
                    </a>
                </li>

                <li>
                    <a id="undo-recent" href="#" draggable="false">
                      <i class="fa fa-undo fa-3"></i>
                    </a>
                </li>

                <li>
                    <a id="redo-recent" href="#" draggable="false">
                      <i class="fa fa-repeat fa-3"></i>
                    </a>
                </li>

            </ul>
            <!-- Project Navigation (Close, Play/Pause, Stop, Step Back, Step Forward etc) -->

            <div class="nav navbar-nav projectnav text-center" style="-webkit-app-region: no-drag">
                <div class="titlebar">
                    <p class="title">Project Name</p>
                    <p class="project">~/Projects/Project Name</p>
                </div>
            </div>
            <!-- Project Center (Project Title & Project Location) -->

            <ul class="nav navbar-nav navbar-right projectnav" style="-webkit-app-region: no-drag">
                <div class="col-xs-1">
                    <form id="bpm-control" class="navbar-form">
                      <div class="input-group">
                          <input type="number" class="form-control bpm-input" placeholder="140" min="20.0" max="999.0" id="bpm" name="bpm" value="140" autocomplete="off" required="required">
                      </div>
                    </form>
                </div>
                <li class="dropdown bpm-push">
                    <a href="#menus" class="dropdown-toggle" data-toggle="dropdown" draggable="false"><div class="btn btn-default"><div class="hamburger-menu"></div></div></a>
                    <ul class="dropdown-menu">
                      <li>
                          <a href="#" class="openproject" draggable="false">Open Project</a>
                      </li>
                      <li>
                          <a href="#" data-toggle="modal" data-target="#collaborate-start" draggable="false" class="saveproject">Save Project</a>
                      </li>
                      <li class="divider"> </li>
                      <li>
                          <a href="#" draggable="false">Export</a>
                      </li>
                    </ul>
                </li>
                <li class="dropdown">
                    <a href="#preferences" class="dropdown-toggle" data-toggle="dropdown" draggable="false"><div class="btn btn-default"><div class="cog-button"></div></div></a>
                    <ul class="dropdown-menu">
                      <li>
                          <a href="#" data-toggle="modal" data-target="#collaborate-start" draggable="false">Add User(s) to Project</a>
                      </li>
                      <li class="divider"></li>
                      <li>
                          <a class="open-external" href="https://github.com/jakehh/vanguard" draggable="false"><i class="fa fa-github"></i> Github</a>
                      </li>
                      <li class="divider"></li>
                      <li>
                          <a class="open-external" href="https://github.com/jakehh/vanguard/issues" target="_blank" draggable="false">Report a Bug</a>
                      </li>
                      <li>
                          <a class="open-external" href="https://github.com/jakehh/vanguard/wiki" target="_blank" draggable="false">Help</a>
                      </li>
                      <li class="divider"></li>
                      <li>
                          <a href="#" data-toggle="modal" data-target="#settings" draggable="false">Preferences</a>
                      </li>
                      <li class="divider"></li>
                      <li>
                          <a href="#" id="about-panel" draggable="false">About</a>
                      </li>
                    </ul>
                </li>
            </ul>
            <!-- Right Project Navigation (BPM, Menu, Preferences & Fullscreen) -->

          </div><!-- /.navbar-collapse -->

      </nav>
      <!-- End Navigation -->

      <div class="container-fluid new-content" id="newpage">
          <h1 class="landing-text">No projects are open yet.</h1>
          <h4 class="landing-text push-content">Open/Create a project to begin</h4>
          <div class="landingpage-content">
            <div class="row">
                <a id="newproject" class="newproject" href="#" draggable="false">
                    <div class="col-md-2">
                      <i class="fa fa-file fa-5x"></i>
                    </div>
                    <div class="col-lg-3">
                      <h3>New Project</h3>
                      <h5>Start a new project</h5>
                    </div>
                </a>
            </div>

            <div class="row">
                <a class="openproject" href="#" draggable="false">
                    <div class="col-md-2">
                      <i class="fa fa-clipboard fa-5x"></i>
                    </div>
                    <div class="col-lg-3">
                      <h3>Open Project</h3>
                      <h5>Open a new project</h5>
                    </div>
                </a>
            </div>

            <div class="row">
                <a class="collaborations" href="#" data-toggle="modal" data-target="#collaborate" draggable="false">
                    <div class="col-md-2">
                      <i class="fa fa-users fa-5x"></i>
                    </div>
                    <div class="col-lg-3">
                      <h3>Collaborate</h3>
                      <h5>Collaborate with friends</h5>
                    </div>
                </a>
            </div>
          </div>
      </div>
      <!-- End Landing Page -->

      <div class="container-fluid" id="project">
          <div class="row dawinner">
              <div class="col-md-2 sidebar">
                <div id="left" class="span3">

                    <ul id="instruments-menu" class="nav menu" data-toggle="collapse" data-parent="#menu-group-1" href="#instruments">
                      <li class="instruments deeper parent">
                          <a class="" href="#" draggable="false" class="menu-item">
                              <span class="sign">Instruments</span>
                          </a>
                          <ul class="children nav-child unstyled small collapse" id="instruments">
                              List of Instruments (Will be adding some JS Instruments soon)
                          </ul>
                      </li>
                    </ul>
                    <!-- End Instruments -->

                    <ul id="effects-menu" class="nav menu" data-toggle="collapse" data-parent="#menu-group-1" href="#effects">
                      <li class="instruments deeper parent">
                          <a class="" href="#" draggable="false">
                              <span class="sign">Effects</span>
                          </a>
                          <ul class="children nav-child unstyled small collapse" id="effects">
                              List of Effects (will be added later)
                          </ul>
                      </li>
                    </ul>
                    <!-- End Effects -->

                    <ul id="library-menu" class="nav menu" data-toggle="collapse" data-parent="#menu-group-1" href="#library">
                      <li class="library deeper parent">
                          <a class="" href="#" draggable="false">
                              <span class="sign">Library</span>
                          </a>
                          <ul class="children nav-child unstyled small collapse" id="library">
                              List of Samples/Whatever is in /library/ for User
                          </ul>
                      </li>
                    </ul>
                    <!-- End Library -->
		</div>
          </div>
              <!-- End Left Sidebar -->

              <div class="col-md-10 scrollable dawcontent">
                  <!-- Start Timeline / DAW Contents -->
                  <div class="span9 scrollable">
                      <div class="row-fluid timeline_pull">
                          <div class="span1" style="position:relative;">
                              <div id="clock" class="clock"></div>
                          </div>
                          <div class="span1 tcontrols" >
                          <div id="zoom">
                              <div class="btn-toolbar">
                                <div class="btn-group">
                                    <button type="button" class="btn btn-mini" id = "zoomOut">
                                        <i class="fa fa-minus"></i>
                                    </button>
                                    <button type="button" class="btn btn-mini" id = "zoomIn">
                                        <i class="fa fa-plus"></i>
                                    </button>
                                </div>
                              </div>
                          </div>
                      </div>
                      <div class="span10 timeline">
                          <canvas id="timeline">
                          </canvas>
                      </div>
                    </div>
                    <div id="tracks">
                    </div>
                </div>
            </div>
            <!-- End Timeline / DAW -->

            <div class="col-md-1 rightsidebar">
                <div id="trackcontrols">

                </div>

                <div id="masterControl" class="span1 well">
                    <canvas id="VUmeterCanvas" width="30" height="80" style="display: block;">

                    </canvas>

                    <div id="masterVolume">

                    </div>

                </div>

                <div id="newTrackButton" class="span9 addTrack">
                    <a id="addTrackButton" href="#"><p class="text-center"><i class="fa fa-plus fa-2x plusButton"></i></p></a>
                </div>

            </div>
            <!-- End Right Sidebar -->
          </div>
      </div>
      <!-- End Project Page -->

      <div class="modal fade" id="collaborate" tabindex="-1" role="dialog" aria-labelledby="aboutLabel" aria-hidden="true">
          <div class="modal-dialog collaboration">
            <div class="modal-content collaboration">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="collabLabel">WebDAW Collaboration - Search</h4>
                </div>
                <!-- End Modal Header -->

                <div class="modal-body">
                    Maybe a table to show a list of Candidates from Searching for {USERNAME}?
                </div>
                <!-- End Modal Body -->

                <div class="modal-footer collab-bottom">
                    <div class="row">
                      <div class="col-lg-12">

                          <div class="input-group custom-search-form">
                              <input type="text" placeholder="Enter username..." class="form-control">
                              <span class="input-group-btn">
                                <button class="btn btn-success" type="button">
                                    <span class="fa fa-search"></span>
                                </button>
                              </span>
                          </div><!-- End of Input Group / Search Form -->

                      </div>
                    </div>
                </div>
                <!-- End Modal Footer -->

            </div>
            <!-- End Modal Content -->
          </div>
      </div>
      <!-- End Collaboration (Landing Page) Modal -->

      <div class="modal fade settings" id="settings" tabindex="-1" role="dialog" aria-labelledby="settingsLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">

                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="settingsLabel">Settings</h4>
                </div>
                 <!-- End Modal Header -->

                <div class="modal-body">

                </div>
                 <!-- End Modal Body -->

                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-dismiss="modal">Dismiss Changes</button>
                    <button type="button" class="btn btn-default">Save changes</button>
                </div>
                 <!-- End Modal Footer -->

            </div>
             <!-- End Modal Content -->
          </div>
      </div>
      <!-- End Settings Modal -->

      <!-- 3rd party Dependencies, Run these first so the app knows that everything exists -->
      <script src="lib/jquery/jquery-1.11.0.min.js"></script>
      <script src="lib/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script src="lib/jquery/jquery-ui.js"></script>
      <script src="lib/google/canvas.js"></script>
      <script src="lib/audio-polyfill/audio-polyfill.js"></script>
      <script src="lib/wavesurfer/wavesurfer.js"></script>
      <script src="lib/wavesurfer/wavesurfer.timeline.js"></script>
      <script src="lib/wavesurfer/drawer.js"></script>
      <script src="lib/audio-polyfill/webaudio.js"></script>
      <script src="lib/jquery/jquery.knob.js"></script>
      <script src="lib/undojs/undo.js"></script>
      <script src="lib/alertify/alertify.min.js"></script>
      <script src="lib/mousetrap/mousetrap.min.js"></script>
      <script src="lib/bootstrap/bootstrap.min.js"></script>

      <!-- Core Dependencies (OpenDAW Legacy Code) Will be porting these to Node to allow for a better overall experience -->
      <script src="lib/core/scheduler.js"></script>
      <script src="lib/core/storage.js"></script>
      <script src="lib/core/recorder.js"></script>
      <script src="lib/core/effects.js"></script>
      <script src="lib/core/vumeter.js"></script>
      <script src="lib/core/osx-menu.js"></script>

      <!-- Requirements to run the Application -->
      <script src="database.js"></script>
      <script src="settings.js"></script>
      <script src="app.js"></script>

      <script>
          var ngui = require('nw.gui');
          var nwin = ngui.Window.get();

          //   On Close, Verify if the user has changed anything, if the application hasn't had any changes, Close without asking the user.
          nwin.on('close', function() {
              if(projectState.currentState != null) {
                  var confirmExit = confirm('Do You wish to exit Vanguard?');
                  if(confirmExit == true) {
                      nwin.hide();
                      nwin.close(true);
                  }
              } else {
                //   Otherwise, Just close the program because you're on the landing page.
                  nwin.hide();
                  nwin.close(true);
              }
          });


          // Open Links in Default Browser (Prevent loading inside of node-webkit Instance)
          $('.open-external').click(function(e) {
              e.preventDefault();
              ngui.Shell.openExternal($(this).attr('href'));
          });

          $( ".fullscreen" ).click(function() {
            nwin.toggleFullscreen();
            var $this = $(".icon-fullscreen");

            if ($this.hasClass("fa-expand"))
            {
                $this.removeClass("fa-expand").addClass("fa-compress");
                return;
            }

            if ($this.hasClass("fa-compress"))
            {
                $this.removeClass("fa-compress").addClass("fa-expand");
                return;
            }

          });

          $( "#playPause" ).click(function() {
              var $this = $(".icon-playpause");

              if ($this.hasClass("fa-play"))
              {
                  $this.removeClass("fa-play").addClass("fa-pause");
                  return;
              }

              if ($this.hasClass("fa-pause"))
              {
                  $this.removeClass("fa-pause").addClass("fa-play");
                  return;
              }

          });

          $( "#stop" ).click(function() {
              var $this = $(".icon-playpause");

              if ($this.hasClass("fa-play"))
              {
                  $this.removeClass("fa-play").addClass("fa-pause");
                  return;
              }

              if ($this.hasClass("fa-pause")) {
                  $this.removeClass("fa-pause").addClass("fa-play");
                  return;
              }

          });

          // Functions
          function clearProject() {

              $("#tracks").empty();
              $("#trackcontrols").empty();
              trackNumber = 0;
              globalNumberOfTracks = 0;
              newTrackNumber = 1;
          }

          //   Create New Project
          function newProject() {
              $( "#bpm" ).show();
              $( "#project" ).show();
              $( ".projectnav" ).show();
              $( "#newpage" ).hide();
              $( "#landingpage" ).hide();
              $( "#landingpage-left").hide();
              $( "#landingpage-right").hide();
              $(".title").html(defaultTitle);
              $(".project").html(defaultLocation);
              projectState.currentState = "newProject";
              vanguard.newProject();
              // These are currently the only way to bypass the original code while I continue work on making a new code base.
              createTrack(1);
              createTrack(2);
              createTrack(3);
              createTrack(4);
              globalNumberOfTracks = 4;
              newTrackNumber = 5;
              console.log(projectState);
          };

          // Close Current Project
          function closeCurrent() {
              if(projectState.currentState != null) {
                  var confirmExit = confirm('Do You wish to close this project?');
                  if(confirmExit == true) {
                      $( "#newpage" ).show();
                      $( "#landingpage" ).show();
                      $( "#landingpage-left").show();
                      $( "#landingpage-right").show();
                      $( "#project" ).hide();
                      $( "#bpm" ).hide();
                      $( ".projectnav" ).hide();
                      projectState.currentState = null;
                      console.log(projectState);
                      clearProject();
                  }
              }
              else
              {
                  // Ask if the user wants to exit WebDAW?
                  // This way, if a user clicks Ctrl+W on the landing page, It's a better experience as you'd expect it to behave in a way where Ctrl+W would close the window if you didn't have any projects open.
                  nwin.close();
              }
          }

          function openProject()  // Open Project
          {
              fileChooser('#openfileDialog');
              if( $('#openfileDialog').val() == "" ) {
                  projectState.currentState = "openedProject";
                  console.log(projectState);
              }
          };

          function saveProject() // Save Project
          {
              saveFile('#saveasDialog');
          }

          function consoleLog()
          {
              console.log('%cWebDAW is a fork of OpenDAW, to create a more modern UI for a web based DAW (Digital Audio Workstation) [PS. ur liek supa hax !!! congratz]', 'color: lightgreen; background-color: black;');
          }

          // Not Functions

          $( "body" ).load(function() {
              // Loading screen, probably do this in index
              $( "#newpage" ).hide();
              $( "#landingpage" ).hide();
              $( "#landingpage-left" ).hide();
              $( "#landingpage-right" ).hide();
              $( "#project" ).hide();
              $( "#bpm" ).hide();
              $( ".projectnav" ).hide();

              // A little about snippet for some fun / little easter egg :~)
              consoleLog();
          });

          $( window ).ready(function() {
              $( "#newpage" ).show();
              $( "#landingpage" ).show();
              $( "#landingpage-left" ).show();
              $( "#landingpage-right" ).show();
              $( "#project" ).hide();
              $( "#bpm" ).hide();
              $( ".projectnav" ).hide();

              // A little about snippet for some fun / little easter egg :~)
              consoleLog();
          });

          $( ".newproject" ).click(function()  // New Project
          {
              newProject();
          });

          $( ".openproject" ).click(function()  // Open Project
          {
              openProject();
          });

          $( ".saveproject" ).click(function()  // Save Project
          {
              saveProject();
          });

          $( ".close-button" ).click (function() // Close Project
          {
              nwin.close();
          });

          $( "#about-panel" ).click (function(){
              aboutWindow = gui.Window.open('about.html', {
                  position: 'center',
                  toolbar: false,
                  frame: false,
                  transparent: true,
                  resizable: false,
                  focus: true,
                  width: 400,
                  height: 500
              });
          });

          $( ".minimize-button" ).click(function() {
              win.minimize();
          });

          // Listen to the minimize event
          win.on('minimize', function() {
              console.log('Window is minimized');
          });

          // Toggle between Fullscreen icons

          $( ".fullscreen-button" ).click(function() {
              win.toggleFullscreen();
              var $this = $(".fullscreen-button");
              if ($this.hasClass("fullscreen-expand")) {
                  $this.removeClass("fullscreen-expand").addClass("fullscreen-compress");
                  return;
              }
              // End IF statement

              if ($this.hasClass("fullscreen-compress")) {
                  $this.removeClass("fullscreen-compress").addClass("fullscreen-expand");
                  return;
              }
              // End IF statement

          });
          // End of .click

          // Keyboard Shortcuts

          $( window ).keyup(function (e) {
              console.log(e.keyCode);
              // Output which keys the user Presses (Have REMOVE-DEBUG at end of each Debug feature inside index.html) REMOVE-DEBUG
              var key = window.event? event : e


              if(key.keyCode == 78 && key.ctrlKey)  // New Project
              {
                  newProject();
              }

              if(key.keyCode == 79 && key.ctrlKey)  // Open Project
              {
                  openProject();
              }

              if(key.keyCode == 32)  // Pause/Play
              {
                  $('body').trigger('playPause-event');
                  var $this = $(".icon-playpause");

                  if ($this.hasClass("fa-play"))
                  {
                    $this.removeClass("fa-play").addClass("fa-pause");
                    return;
                  }
                  if ($this.hasClass("fa-pause"))
                  {
                    $this.removeClass("fa-pause").addClass("fa-play");
                    return;
                  }
              }

              if(key.keyCode == 87 && key.ctrlKey) // Close Project
              {
                  closeCurrent();
              }

              if(key.keyCode == 188 && key.ctrlKey) // Settings
              {
                //   $('#settings').modal('toggle');
              }

          });

          // Popovers for Bootstrap
          $( ".newproject" ).popover({ trigger: "hover" });
          $( ".openproject" ).popover({ trigger: "hover" });
          $( ".collaborations" ).popover({ trigger: "hover" });

          // Handler for pressing enter on BPM/Tempo
          $( "#bpm-control" ).submit(function( event ) {
              //   alert( "Handler for .submit() called." );
              $('input').blur();

              var bpm = $( "#bpm" ).val();
              console.log(bpm);
              event.preventDefault();
          });

          // Drag events for when a user drags a file onto the program
          window.ondragover = function(e) { e.preventDefault(); return false; };
          window.ondrop = function(e) { e.preventDefault(); return false; };

          holder.ondrop = function (e)
          {
              e.preventDefault();
              var file = e.dataTransfer.files[0],
                  reader = new FileReader();
              reader.onload = function (event)
              {
                  console.log(event.target);
              };

              console.log(file);
              reader.readAsDataURL(file);
              return false;
          };

          $('#instruments-menu').click(function() {
            var $this = $(".menu-item");
              if ($this.hasClass("selectedmenu")) {
                  $this.removeClass("selectedmenu");
                  return;
              }
              // End IF statement

              else {
                  $this.addClass("selectedmenu");
                  return;
              }
          });

          // When you scroll in the DAW the Track Controls Should also scroll.
          $('.dawcontent').on('scroll', function () {
              $('.rightsidebar').scrollTop($(this).scrollTop());
          });
      </script>
      <input style="display:none;" id="openfileDialog" type="file" accept=".zip,.json,.xml" />
      <input style="display:none;" id="saveasDialog"  type="file" nwsaveas />
    </body>
</html>
